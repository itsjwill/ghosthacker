
{
  "vulnerabilities": [
    {
      "ID": "AUTHZ-VULN-01",
      "vulnerability_type": "Horizontal",
      "externally_exploitable": true,
      "endpoint": "POST /api/change_password.php",
      "vulnerable_code_location": "/app/website/api/change_password.php:31",
      "role_context": "visitor (any authenticated user)",
      "guard_evidence": "Missing ownership validation: Line 31 uses $_POST['userId'] in UPDATE statement without verifying it matches $_SESSION['user_id']. Authentication check exists (lines 7-10) but authorization check is completely absent. The endpoint verifies the requester's old password (line 29 checks against $_SESSION['user_id']) but changes password for arbitrary user specified in POST body.",
      "side_effect": "Change password for any user including admin (user_id=7), enabling complete account takeover and CTF flag capture",
      "reason": "Authorization logic flaw: password verification uses session user_id (line 26) but password UPDATE uses POST userId parameter (line 31). No validation that POST userId equals session user_id. Any authenticated user can change any other user's password by providing their own oldPassword and victim's userId.",
      "minimal_witness": "1) Register and login as attacker to obtain session. 2) POST to /api/change_password.php with oldPassword=<attacker's current password>, newPassword=<attacker chosen>, confirmPassword=<same>, userId=7 (admin). 3) Attacker's password passes verification (line 29). 4) Admin's password is updated (line 31). 5) Login as admin with new password to capture FLAG.",
      "confidence": "high",
      "notes": "CRITICAL severity - direct path to admin compromise and CTF flag capture. Database query at line 30-31: 'UPDATE users SET password = :password WHERE id = :id' uses $_POST['userId'] without ownership check. Reconnaissance report confirms admin is user_id=7. Exploitation requires only valid authentication (trivially obtained via public /api/register.php). Attack chain: visitor → IDOR password change → admin login → FLAG capture. No rate limiting, no CAPTCHA, no audit logging. Externally exploitable via http://localhost:34999 from public internet."
    },
    {
      "ID": "AUTHZ-VULN-02",
      "vulnerability_type": "Horizontal",
      "externally_exploitable": true,
      "endpoint": "GET /api/get_favorite_restaurants.php",
      "vulnerable_code_location": "/app/website/api/get_favorite_restaurants.php:14",
      "role_context": "visitor (any authenticated user)",
      "guard_evidence": "Missing ownership validation: Line 14 accepts $_GET['userId'] without verifying it matches $_SESSION['user_id']. Authentication check exists (lines 7-10) but authorization check is completely absent. Database query (lines 17-24) uses attacker-controlled userId parameter to fetch any user's favorites.",
      "side_effect": "Read any user's favorite restaurants (personal data, privacy violation), including admin's favorites for reconnaissance",
      "reason": "Authorization logic flaw: endpoint accepts userId from GET parameter without ownership validation. Database query 'SELECT users.username, favorite_restaurants.restaurant_name FROM favorite_restaurants WHERE users.id = :user_id' (lines 17-24) uses client-provided userId. No check that GET userId equals session user_id exists anywhere in the code.",
      "minimal_witness": "1) Register and login as attacker to obtain session. 2) GET /api/get_favorite_restaurants.php?userId=1 (or any user ID). 3) API returns victim's username and list of favorite restaurants. 4) Enumerate all users by iterating userId=1,2,3,...,N to harvest all user data.",
      "confidence": "high",
      "notes": "HIGH severity - privacy violation and horizontal privilege escalation. Data exposed includes username and restaurant preferences (personal dietary habits, location patterns). Enables user enumeration and profiling. No rate limiting allows mass data exfiltration. Attack requires only authenticated session (obtain via /api/register.php). Database query properly uses prepared statements (SQL injection protected) but authorization is completely missing. Externally exploitable via http://localhost:34999 from public internet. Can be chained with AUTHZ-VULN-01: enumerate users → change passwords → mass account takeover."
    }
  ]
}