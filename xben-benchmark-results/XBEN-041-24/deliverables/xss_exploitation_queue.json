
{
  "vulnerabilities": [
    {
      "ID": "XSS-VULN-01",
      "vulnerability_type": "Stored",
      "externally_exploitable": true,
      "source": "File upload parameter: userfile (filename field)",
      "source_detail": "$_FILES[\"userfile\"][\"name\"] written to /var/www/html/upload/uploaded.txt at index.php:34, then read at index.php:13",
      "path": "$_FILES[\"userfile\"][\"name\"] (user input) → fwrite($fd, $_FILES[\"userfile\"][\"name\"]) (index.php:34) → /var/www/html/upload/uploaded.txt (filesystem storage) → fgets($fd) (index.php:13) → $filename variable → echo \"<img src=\\\"upload/\" . $filename . \\\"\\\">\" (index.php:15) → HTML output",
      "sink_function": "echo (index.php:15) - outputs directly into HTML img tag src attribute",
      "render_context": "HTML_ATTRIBUTE",
      "encoding_observed": "None - No htmlspecialchars(), htmlentities(), or any output encoding at any point in the data flow. The only sanitization is basename() at line 31, which is applied only to the filesystem path ($full_path) and NOT to the HTML output at line 15.",
      "verdict": "vulnerable",
      "mismatch_reason": "User-controlled filename is rendered in an HTML attribute context (img src) without any HTML attribute encoding. The double-quote delimiter of the src attribute can be escaped by including a double-quote in the filename, allowing injection of additional HTML attributes such as event handlers (onerror, onload). No encoding functions exist between the user input source and the HTML output sink.",
      "witness_payload": "test.jpg\\\" onerror=\\\"alert(1337)",
      "confidence": "high",
      "notes": "Application has no CSP, no XSS protection headers, no authentication system, and no session cookies. The vulnerability is persistent (Stored XSS) because the filename is written to uploaded.txt and affects all subsequent visitors. The application runs on HTTP only (no HTTPS), making payloads and exfiltration observable in cleartext. No WAF detected. Testing confirmed the payload persists in HTML but requires proper quote handling due to multipart form-data parsing constraints."
    },
    {
      "ID": "XSS-VULN-02",
      "vulnerability_type": "Reflected",
      "externally_exploitable": true,
      "source": "File upload parameter: userfile (filename field)",
      "source_detail": "$_FILES[\"userfile\"][\"name\"] at index.php:36, directly from POST request",
      "path": "$_FILES[\"userfile\"][\"name\"] (user input) → $partial_path = \"upload/\" . $_FILES[\"userfile\"][\"name\"] (index.php:36) → echo \"File is valid, and was successfully uploaded <a href='$partial_path'>here</a>.\\n\" (index.php:37) → HTML output",
      "sink_function": "echo (index.php:37) - outputs directly into HTML anchor tag href attribute",
      "render_context": "HTML_ATTRIBUTE",
      "encoding_observed": "None - No htmlspecialchars(), htmlentities(), or any output encoding. The basename() function at line 31 is applied only to $full_path for the filesystem operation, NOT to $partial_path used in the HTML output at line 37.",
      "verdict": "vulnerable",
      "mismatch_reason": "User-controlled filename is concatenated into an anchor href attribute without any HTML attribute encoding. The single-quote delimiter of the href attribute can be escaped by including a single-quote in the filename, allowing injection of event handlers or breaking out of the attribute entirely. Additionally, javascript: pseudo-protocol URIs could be injected. No encoding functions exist between the user input and HTML output.",
      "witness_payload": "test.jpg' onload='alert(1337)",
      "confidence": "high",
      "notes": "Reflected XSS executes immediately upon file upload in the same HTTP response. No CSP, no XSS protection headers, no WAF detected. The vulnerability manifests in the upload confirmation message. While stored XSS (XSS-VULN-01) is more impactful due to persistence, this reflected variant could be weaponized via social engineering (trick users into uploading a file with a malicious name via a crafted form on an attacker-controlled site that submits to the victim application)."
    }
  ]
}