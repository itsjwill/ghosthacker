
{
  "vulnerabilities": [
    {
      "ID": "XSS-VULN-01",
      "vulnerability_type": "Stored",
      "externally_exploitable": true,
      "source": "Database field: posts.title (VARCHAR(255))",
      "source_detail": "Database read: mysqli::query() at /app/html/index.php:50 executes 'SELECT * FROM posts WHERE published = 1 ORDER BY created_at DESC', result fetched via fetch_assoc() at line 57, field accessed as $row['title']",
      "path": "Database (posts.title) → mysqli_result::fetch_assoc() [line 57] → $row['title'] [line 59] → Direct string interpolation in echo [line 59] → Rendered in HTML <h2> tag",
      "sink_function": "echo with string interpolation at /app/html/index.php:59",
      "render_context": "HTML_BODY",
      "encoding_observed": "None - No calls to htmlspecialchars(), htmlentities(), or any encoding function between database read (line 50) and sink (line 59)",
      "verdict": "vulnerable",
      "mismatch_reason": "HTML_BODY context requires HTML entity encoding via htmlspecialchars($row['title'], ENT_QUOTES, 'UTF-8'). No encoding is applied. Data flows directly from database to HTML output, allowing any HTML/JavaScript in the title field to execute in the browser.",
      "witness_payload": "<script>alert(document.domain)</script>",
      "confidence": "high",
      "notes": "Session cookie lacks HttpOnly flag (per recon report), making this ideal for session theft. No CSP configured. Attack chain: SQL injection in admin.php allows database poisoning → XSS executes for all users viewing /index.php. Payload executes immediately on page load."
    },
    {
      "ID": "XSS-VULN-02",
      "vulnerability_type": "Stored",
      "externally_exploitable": true,
      "source": "Database field: posts.category (VARCHAR(100))",
      "source_detail": "Database read: mysqli::query() at /app/html/index.php:50 executes 'SELECT * FROM posts WHERE published = 1 ORDER BY created_at DESC', result fetched via fetch_assoc() at line 57, field accessed as $row['category']",
      "path": "Database (posts.category) → mysqli_result::fetch_assoc() [line 57] → $row['category'] [line 60] → Direct string interpolation in echo [line 60] → Rendered in HTML <p> tag",
      "sink_function": "echo with string interpolation at /app/html/index.php:60",
      "render_context": "HTML_BODY",
      "encoding_observed": "None - No encoding functions found in data flow path from database (line 50) to output (line 60)",
      "verdict": "vulnerable",
      "mismatch_reason": "HTML_BODY context requires HTML entity encoding. The category value is output directly: '<p>Category: {$row['category']}</p>'. Any HTML tags or JavaScript in the category field will be interpreted by the browser.",
      "witness_payload": "<img src=x onerror=alert('XSS')>",
      "confidence": "high",
      "notes": "Same database poisoning attack chain as XSS-VULN-01. Category field is displayed for every post on the homepage. Shorter payload possible due to img tag efficiency (28 chars vs script tag)."
    },
    {
      "ID": "XSS-VULN-03",
      "vulnerability_type": "Stored",
      "externally_exploitable": true,
      "source": "Database field: posts.content (TEXT)",
      "source_detail": "Database read: mysqli::query() at /app/html/index.php:50 executes 'SELECT * FROM posts WHERE published = 1 ORDER BY created_at DESC', result fetched via fetch_assoc() at line 57, field accessed as $row['content']",
      "path": "Database (posts.content) → mysqli_result::fetch_assoc() [line 57] → $row['content'] → substr($row['content'], 0, 200) [line 62] → Concatenated into echo [line 62] → Rendered in HTML <p> tag",
      "sink_function": "echo with concatenation at /app/html/index.php:62",
      "render_context": "HTML_BODY",
      "encoding_observed": "None - The substr() function at line 62 performs string truncation but is NOT a security control. No htmlspecialchars() or encoding applied",
      "verdict": "vulnerable",
      "mismatch_reason": "HTML_BODY context requires encoding. The substr() operation truncates content to 200 characters but does NOT encode HTML entities. XSS payloads under 200 characters (e.g., '<svg onload=alert(1)>' = 23 chars) will execute fully. Truncation only limits payload size, not attack capability.",
      "witness_payload": "<svg onload=alert(document.cookie)>",
      "confidence": "high",
      "notes": "Content field is TEXT type (unlimited length in DB). Truncation to 200 chars is NOT a defense - many effective XSS payloads fit: '<script>alert(1)</script>' = 25 chars. Attack persists across all page views."
    },
    {
      "ID": "XSS-VULN-04",
      "vulnerability_type": "Stored",
      "externally_exploitable": true,
      "source": "Database field: posts.image (VARCHAR(255))",
      "source_detail": "Database read: mysqli::query() at /app/html/index.php:50 executes 'SELECT * FROM posts WHERE published = 1 ORDER BY created_at DESC', result fetched via fetch_assoc() at line 57, field accessed as $row['image']",
      "path": "Database (posts.image) → mysqli_result::fetch_assoc() [line 57] → $row['image'] [line 61] → String interpolation in single-quoted src attribute [line 61] → Rendered in HTML <img src='...'> attribute",
      "sink_function": "echo with string interpolation at /app/html/index.php:61 in img src attribute",
      "render_context": "HTML_ATTRIBUTE",
      "encoding_observed": "None - Value is prefixed with 'images/' but no htmlspecialchars() or attribute encoding applied. The prefix does NOT prevent attribute breakout.",
      "verdict": "vulnerable",
      "mismatch_reason": "HTML_ATTRIBUTE context with single quotes requires htmlspecialchars($row['image'], ENT_QUOTES, 'UTF-8'). Without encoding, attacker can inject a single quote (') to break out of the src attribute and add event handlers. The 'images/' prefix only affects path resolution, not XSS prevention.",
      "witness_payload": "x.jpg' onerror='alert(document.cookie)",
      "confidence": "high",
      "notes": "Single-quoted attribute: src='images/{$row['image']}'. Payload closes src with single quote, adds onerror handler. When image fails to load (x.jpg doesn't exist), JavaScript executes. Alternative payloads: onload, onmouseover, etc. Very reliable exploitation."
    },
    {
      "ID": "XSS-VULN-05",
      "vulnerability_type": "Stored",
      "externally_exploitable": true,
      "source": "Database field: posts.title (VARCHAR(255)) - SECOND USAGE",
      "source_detail": "Database read: Same as XSS-VULN-01 (mysqli::query() at /app/html/index.php:50), but this vulnerability is in the img alt attribute at line 61, not the h2 tag. Same $row['title'] field used in TWO different render contexts.",
      "path": "Database (posts.title) → mysqli_result::fetch_assoc() [line 57] → $row['title'] [line 61] → String interpolation in single-quoted alt attribute [line 61] → Rendered in HTML <img alt='...'> attribute",
      "sink_function": "echo with string interpolation at /app/html/index.php:61 in img alt attribute",
      "render_context": "HTML_ATTRIBUTE",
      "encoding_observed": "None - No htmlspecialchars() applied despite being in attribute context",
      "verdict": "vulnerable",
      "mismatch_reason": "HTML_ATTRIBUTE context requires htmlspecialchars() with ENT_QUOTES flag to encode both single and double quotes. The title field is used in a single-quoted attribute: alt='{$row['title']}'. An attacker can inject a single quote to break out and add event handlers like onerror or onmouseover.",
      "witness_payload": "x' onerror='alert(1)",
      "confidence": "high",
      "notes": "This is DISTINCT from XSS-VULN-01 (same source field, different render context). Line 59 uses title in HTML_BODY context, line 61 uses it in HTML_ATTRIBUTE context. Different exploitation techniques required. A single malicious title value can exploit BOTH vulnerabilities simultaneously: '<script>alert(1)</script>x' onerror='alert(2)' would trigger alert(1) at line 59 and alert(2) at line 61."
    },
    {
      "ID": "XSS-VULN-06",
      "vulnerability_type": "Stored",
      "externally_exploitable": true,
      "source": "Database field: posts.category (VARCHAR(100)) - DISTINCT query for dropdown",
      "source_detail": "Database read: DIFFERENT query from other vulnerabilities. Line 26 executes 'SELECT DISTINCT category FROM posts' specifically to populate category dropdown. Result fetched via fetch_assoc() at line 27, accessed as $row['category']",
      "path": "Database (posts.category) → SELECT DISTINCT category [line 26] → mysqli_result::fetch_assoc() [line 27] → $row['category'] [line 29] → DUAL OUTPUT: (1) String interpolation in single-quoted value attribute, (2) String interpolation in option text content → Rendered in <option> tag",
      "sink_function": "echo at /app/html/index.php:29 with DUAL sinks in one statement",
      "render_context": "DUAL: HTML_ATTRIBUTE (value='...') AND HTML_BODY (option text)",
      "encoding_observed": "None - Category value appears TWICE in same tag without any encoding: \"<option value='{$row['category']}' {$selected}>{$row['category']}</option>\"",
      "verdict": "vulnerable",
      "mismatch_reason": "DUAL CONTEXT vulnerability: (1) HTML_ATTRIBUTE context (value='...') requires htmlspecialchars() with ENT_QUOTES to prevent attribute breakout. (2) HTML_BODY context (option text) requires HTML entity encoding to prevent tag injection. Neither encoding is applied. Attacker can craft payloads exploiting either or both contexts.",
      "witness_payload": "' onclick='alert(document.domain)",
      "confidence": "high",
      "notes": "CRITICAL: This is a SEPARATE code path from XSS-VULN-02 (which uses the same database field). Line 26 query is DISTINCT from line 50 query - one populates dropdown (lines 25-31), other displays posts (lines 57-64). DUAL injection points in single tag create multiple attack vectors: (1) Break attribute with single quote: ' onclick='alert(1)', (2) Close option tag: '></option><script>alert(1)</script><option value=', (3) Hybrid payload. Attack affects all users viewing homepage dropdown."
    }
  ]
}