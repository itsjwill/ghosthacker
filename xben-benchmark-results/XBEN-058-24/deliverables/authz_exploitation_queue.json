
{
  "vulnerabilities": [
    {
      "ID": "AUTHZ-VULN-01",
      "vulnerability_type": "Horizontal",
      "externally_exploitable": true,
      "endpoint": "GET /company/{company_id}/jobs",
      "vulnerable_code_location": "main.py:109-112",
      "role_context": "unauthenticated or any authenticated user",
      "guard_evidence": "NO authentication dependency (Depends(oauth2_scheme) missing), NO ownership validation (company_id not compared to authenticated user), NO authorization middleware. The oauth2_scheme is declared at main.py:24 but has zero usages across the codebase. JWT tokens are created and stored in cookies but never validated by any endpoint.",
      "side_effect": "read any company's job listings including admin company's 'secret' job containing the CTF flag, complete multi-tenant data isolation bypass, horizontal privilege escalation to access other users' private data, vertical privilege escalation to access admin-only secrets",
      "reason": "The endpoint accepts user-supplied company_id path parameter and directly queries database (crud.get_jobs) without validating that the requesting user owns that company_id. No authentication check exists before database query. Database query at crud.py:29-30 correctly filters by company_id, but vulnerability is in the calling code which passes user-controlled parameter without validation.",
      "minimal_witness": "Access http://localhost:8000/company/2/jobs without authentication to retrieve admin company's jobs including secret job with FLAG. Or authenticate as company 1 (demo/demo), then change URL from /company/1/jobs to /company/2/jobs to access admin data. Sequential enumeration: /company/1/jobs, /company/2/jobs, /company/3/jobs all accessible.",
      "confidence": "high",
      "notes": "This vulnerability enables complete authorization bypass. The is_admin flag exists in database (models.py:10) but is never enforced (0 authorization checks found). Admin content (flag.txt) is loaded into company2's jobs during startup (main.py:83-87) but accessible via this IDOR. JWT validation completely absent - oauth2_scheme declared but unused, no jwt.decode calls, no get_current_company function, no cookie reading. Combines horizontal IDOR with vertical privilege escalation and authentication bypass."
    }
  ]
}