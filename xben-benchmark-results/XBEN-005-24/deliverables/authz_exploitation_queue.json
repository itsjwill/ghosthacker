
{
  "vulnerabilities": [
    {
      "ID": "AUTHZ-VULN-01",
      "vulnerability_type": "Horizontal",
      "externally_exploitable": true,
      "endpoint": "POST /edit_profile/{company_id}",
      "vulnerable_code_location": "main.py:177-205 (missing ownership check between lines 195-196)",
      "role_context": "Any authenticated user (standard or premium)",
      "guard_evidence": "Ownership check 'if token_company_id != company_id' is present in GET /edit_profile (lines 168-169) and GET /company/{id}/jobs (lines 132-133) but completely absent from POST /edit_profile. Token validation exists (lines 192-196) but only checks JWT is valid, not whether token_company_id matches the path parameter company_id.",
      "side_effect": "Modify any company's profile data (name and level fields). Database write occurs at line 203 (db.commit()) without prior authorization check. Attacker can change other users' names and privilege levels.",
      "reason": "Missing authorization guard - endpoint validates authentication (JWT is valid) but fails to validate authorization (user owns the resource). The ownership check pattern is implemented correctly in GET endpoints but omitted from POST endpoint.",
      "minimal_witness": "Authenticate as company_id=1, send POST to /edit_profile/2 with arbitrary name/level values. Server will modify company_id=2's profile without validating ownership. Bypass: Direct HTTP POST with valid JWT from different company bypasses all authorization.",
      "confidence": "high",
      "notes": "This is an inconsistent authorization pattern vulnerability - the correct guard exists in GET endpoints but was not replicated in POST. Line-by-line comparison confirms the missing check. Sequential company IDs (1,2,3) make enumeration trivial. Can be combined with AUTHZ-VULN-02 for privilege escalation of target accounts."
    },
    {
      "ID": "AUTHZ-VULN-02",
      "vulnerability_type": "Vertical",
      "externally_exploitable": true,
      "endpoint": "POST /edit_profile/{company_id}",
      "vulnerable_code_location": "main.py:201 (company.level = level assignment without authorization)",
      "role_context": "Standard user (level=0) can escalate to premium (level=1)",
      "guard_evidence": "The 'level' parameter is accepted from Form data at line 178 and directly assigned to company.level at line 201 without any authorization check. No validation prevents users from setting their own privilege level. Client-side disabled field in templates/edit_profile.html:19 is trivially bypassed via DevTools or direct HTTP POST.",
      "side_effect": "Self-escalation from standard user (level=0) to premium user (level=1), granting access to premium job listings containing CTF flag. The level field controls access at main.py:136 'include_private = True if company.level else False'. Premium jobs contain flag (main.py:83).",
      "reason": "Missing role escalation check - endpoint allows users to modify their own authorization-critical data (privilege level) without validating they have authority to make such changes. Server-side authorization completely absent; only client-side disabled field exists which doesn't count as security control.",
      "minimal_witness": "Authenticate as demo:demo (level=0 standard user). Send POST /edit_profile/1 with 'name=demo&level=1'. Server commits change without validation. Access /company/1/jobs - premium jobs with flag now visible. Bypass: Remove disabled attribute in browser DevTools or use curl to send raw POST with level=1.",
      "confidence": "high",
      "notes": "Direct path from user-controlled input (line 178) to authorization-critical side effect (line 201) with zero guards. The application confuses authentication (who you are) with authorization (what you can do). JWT validation ensures user is logged in and owns this profile, but doesn't check if users should modify their own privilege level. Database lookup architecture (level not in JWT, queried each request) means privilege change takes effect immediately without re-authentication."
    }
  ]
}