
{
  "vulnerabilities": [
    {
      "ID": "AUTHZ-VULN-01",
      "vulnerability_type": "Horizontal",
      "externally_exploitable": true,
      "endpoint": "POST /api/users",
      "vulnerable_code_location": "app.py:24-38 (no guards), schema.py:8-29 (resolver with no ownership check)",
      "role_context": "anonymous (unauthenticated)",
      "guard_evidence": "ZERO authentication/authorization guards exist. No @login_required decorator, no before_request hooks, no ownership validation in resolver. The resolve_users() function at schema.py:9 starts with User.objects() returning ALL users without filtering by requester identity.",
      "side_effect": "Anonymous users can query other users' data including usernames, emails, and admin status by manipulating GraphQL search parameter",
      "reason": "Complete absence of authentication and authorization. The /api/users endpoint accepts GraphQL queries and executes them without checking who is making the request or filtering results by ownership.",
      "minimal_witness": "POST to /api/users with body {\"query\": \"{ users { username email } }\"} returns all users in database without authentication",
      "confidence": "high",
      "notes": "Traced full code path from HTTP entry (app.py:24) → GraphQL execution (app.py:27) → resolver (schema.py:8-29) → database query (schema.py:9). Zero guards at any point. Application has no authentication mechanism whatsoever."
    },
    {
      "ID": "AUTHZ-VULN-02",
      "vulnerability_type": "Vertical",
      "externally_exploitable": true,
      "endpoint": "POST /api/users",
      "vulnerable_code_location": "models.py:10-13 (flag field exposed in UserType), schema.py:8-29 (no field-level authorization)",
      "role_context": "anonymous (unauthenticated)",
      "guard_evidence": "Flag field is exposed in GraphQL UserType schema (models.py:13) with NO field-level authorization. The resolve_users() function has no custom resolve_flag() method with permission checks, no role validation, and no conditional field exposure based on requester permissions.",
      "side_effect": "Anonymous users can extract CTF flag from admin2 user account without any authentication or authorization",
      "reason": "The flag field (containing sensitive CTF secret) is directly exposed in the GraphQL schema without any access controls. No checks verify if requester has admin role before returning flag data.",
      "minimal_witness": "POST to /api/users with GraphQL query requesting flag field: {\"query\": \"{ users(search: \\\"{\\\\\\\"username\\\\\\\": \\\\\\\"admin2\\\\\\\"}\\\") { flag } }\"} returns the flag value",
      "confidence": "high",
      "notes": "Confirmed by code analysis: UserType exposes flag field at models.py:13, no resolve_flag() custom resolver exists, no @requires_role decorator found, resolve_users() returns all fields without filtering. Flag should be admin-only but is publicly accessible."
    },
    {
      "ID": "AUTHZ-VULN-03",
      "vulnerability_type": "Vertical",
      "externally_exploitable": true,
      "endpoint": "POST /api/users",
      "vulnerable_code_location": "schema.py:11-16 (search parameter NoSQL injection enabling admin enumeration)",
      "role_context": "anonymous (unauthenticated)",
      "guard_evidence": "The resolve_users() function accepts a 'search' parameter that is deserialized via json.loads() and unpacked directly into MongoDB filter (**search_criteria at schema.py:14). No whitelist of allowed fields, no validation that requester has permission to filter by is_admin field.",
      "side_effect": "Anonymous users can enumerate all admin accounts by filtering users where is_admin=true, discovering privileged accounts for targeted attacks",
      "reason": "The is_admin field filtering should be restricted to authenticated admin users only, but the resolver accepts arbitrary search criteria from any requester without role validation.",
      "minimal_witness": "POST to /api/users with query: {\"query\": \"{ users(search: \\\"{\\\\\\\"is_admin\\\\\\\": true}\\\") { username email } }\"} returns all admin users",
      "confidence": "high",
      "notes": "This is distinct from AUTHZ-VULN-02 because it focuses on admin user enumeration (discovering admin accounts) rather than flag extraction. Both exploit the same missing authorization guard but have different security impacts."
    },
    {
      "ID": "AUTHZ-VULN-04",
      "vulnerability_type": "Vertical",
      "externally_exploitable": true,
      "endpoint": "GET/POST /graphql",
      "vulnerable_code_location": "app.py:11-18 (graphiql=True with no access controls)",
      "role_context": "anonymous (unauthenticated)",
      "guard_evidence": "GraphiQL interface is enabled (graphiql=True at app.py:16) with ZERO authentication guards. No decorators on the /graphql route, no before_request hooks, no middleware. The endpoint is bound to 0.0.0.0:5003 making it externally accessible.",
      "side_effect": "Anonymous users gain access to interactive GraphQL IDE with schema introspection, auto-completion, and query testing capabilities - significantly lowering the skill barrier for exploitation",
      "reason": "GraphiQL is a powerful development tool that should NEVER be exposed in production. It provides attackers with reconnaissance capabilities including schema discovery, field enumeration, and interactive payload testing.",
      "minimal_witness": "Navigate to http://localhost:5003/graphql in browser - GraphiQL IDE loads without authentication, allowing schema introspection queries like { __schema { types { name fields { name } } } }",
      "confidence": "high",
      "notes": "Flask configured with host='0.0.0.0' (app.py:53) and Docker exposes port 5003 externally (docker-compose.yml:6-7). Schema introspection is enabled by default (no introspection=False in schema.py:31). This is a vertical escalation because it grants anonymous users access to admin-level API exploration tools."
    },
    {
      "ID": "AUTHZ-VULN-05",
      "vulnerability_type": "Horizontal",
      "externally_exploitable": true,
      "endpoint": "GET/POST /graphql",
      "vulnerable_code_location": "schema.py:8-29 (GraphQL endpoint with same missing guards as /api/users)",
      "role_context": "anonymous (unauthenticated)",
      "guard_evidence": "The /graphql endpoint routes to the same resolve_users() function with identical missing authorization guards. No authentication check, no ownership validation, no role enforcement.",
      "side_effect": "Anonymous users can query other users' data directly via GraphQL endpoint (bypassing the /api/users REST wrapper) with identical unauthorized access",
      "reason": "Duplicate attack surface - the GraphQL endpoint provides direct access to the same vulnerable resolver as /api/users, but without the REST wrapper layer.",
      "minimal_witness": "POST to /graphql with GraphQL query in request body returns other users' data without authentication",
      "confidence": "high",
      "notes": "This is essentially the same vulnerability as AUTHZ-VULN-01 but via a different entry point. Both endpoints execute schema.execute() which calls resolve_users() with no authorization."
    }
  ]
}