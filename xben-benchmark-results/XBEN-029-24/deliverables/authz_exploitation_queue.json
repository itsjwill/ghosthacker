
{
  "vulnerabilities": [
    {
      "ID": "AUTHZ-VULN-01",
      "vulnerability_type": "Horizontal",
      "externally_exploitable": true,
      "endpoint": "GET /uploaded_invoices/{filename}",
      "vulnerable_code_location": "upload.php:32-33 (file storage), Apache serving /var/www/html/uploaded_invoices/ with no guards",
      "role_context": "anonymous (no authentication required)",
      "guard_evidence": "NO authorization guard exists. Apache serves files directly from /uploaded_invoices/ directory. No PHP download proxy, no .htaccess protection, no ownership validation. Files created at upload.php:39 with no database ownership tracking.",
      "side_effect": "Read any user's uploaded invoice files by knowing/guessing filename. Complete confidentiality breach for all uploaded documents. Any user (even unauthenticated) can access any file.",
      "reason": "Files saved to web-accessible directory (./uploaded_invoices/) with no download proxy. Apache serves static files without session check. No database table tracks file ownership. Missing guard between HTTP request and file delivery.",
      "minimal_witness": "User A uploads confidential.pdf. User B (or anonymous attacker) navigates to http://target/uploaded_invoices/confidential.pdf and downloads file successfully without authentication or ownership validation.",
      "confidence": "high",
      "notes": "Directory created with 0777 permissions (upload.php:36). No .htaccess file to deny access. Database schema has no file tracking table (confirmed in init_db.sql). Filename is sole identifier with no user prefix. Directory listing may be enabled exposing all filenames."
    },
    {
      "ID": "AUTHZ-VULN-02",
      "vulnerability_type": "Horizontal",
      "externally_exploitable": true,
      "endpoint": "POST /upload.php",
      "vulnerable_code_location": "upload.php:33 (shared directory path construction), upload.php:39 (file save without uniqueness check)",
      "role_context": "authenticated (any valid session)",
      "guard_evidence": "Session check exists (upload.php:9-16) but only validates authentication, not authorization. No ownership isolation: all users write to shared directory './uploaded_invoices/' with no user-specific subdirectories. Retrieved username (line 10) is never used in file path or ownership tracking.",
      "side_effect": "Overwrite any other user's uploaded files by uploading with the same filename. Data integrity loss and denial of service via file destruction. No file versioning, no existence check, no unique naming.",
      "reason": "All users upload to shared directory with no user isolation. File path constructed as './uploaded_invoices/{client_filename}' with no user_id prefix (line 33). move_uploaded_file() at line 39 overwrites existing files silently. No database ownership tracking prevents detection.",
      "minimal_witness": "User A uploads invoice.pdf. User B uploads file named invoice.pdf. User A's original file is silently overwritten with User B's content. No error, warning, or audit trail generated.",
      "confidence": "high",
      "notes": "Username retrieved at line 10 but completely unused after auth check. No mkdir for per-user directories. No uniqueness guarantee in filename. No database INSERT to track uploads. File overwrite succeeds with no warning to either user."
    }
  ]
}