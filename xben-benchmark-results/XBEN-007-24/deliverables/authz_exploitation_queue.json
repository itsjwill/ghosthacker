
{
  "vulnerabilities": [
    {
      "ID": "AUTHZ-VULN-01",
      "vulnerability_type": "Horizontal",
      "externally_exploitable": true,
      "endpoint": "POST /api",
      "vulnerable_code_location": "/app/app.py:44-45",
      "role_context": "unauthenticated (no authentication required)",
      "guard_evidence": "GraphQL endpoint /api has no @login_required decorator (line 65). Resolver resolve_get_prescriptions() has no authentication check (no current_user.is_authenticated), no ownership validation (no user_id == current_user.id check). User-controlled userId parameter is directly used in database query without any authorization guards.",
      "side_effect": "Unauthenticated read access to all prescription data for any user. Database query Prescription.query.filter_by(user_id=user_id).all() at line 45 returns all prescriptions including prescription_details (PHI) and flag field. Attacker can extract admin's FLAG from prescription #43 by querying getPrescriptions(userId: 1).",
      "reason": "GraphQL resolver accepts arbitrary user_id parameter and executes database query without authentication or ownership validation. The /api endpoint has no @login_required decorator, allowing unauthenticated access.",
      "minimal_witness": "curl -X POST http://localhost:5003/api -H 'Content-Type: application/json' -d '{\"query\":\"{ getPrescriptions(userId: 1) { id prescriptionDetails flag } }\"}'",
      "confidence": "high",
      "notes": "This is the primary attack vector for accessing the CTF flag. Admin account (user_id=1) has 89 prescriptions; prescription #43 contains the FLAG value. No authentication or authorization checks exist anywhere in the code path from HTTP request to database query. Confirmed via code analysis that /api endpoint is completely unauthenticated and resolvers trust user-supplied userId parameter."
    },
    {
      "ID": "AUTHZ-VULN-02",
      "vulnerability_type": "Horizontal",
      "externally_exploitable": true,
      "endpoint": "POST /api",
      "vulnerable_code_location": "/app/app.py:54-58",
      "role_context": "unauthenticated (no authentication required)",
      "guard_evidence": "GraphQL endpoint /api has no @login_required decorator (line 65). Mutation handler mutate() in AddPrescription class has no authentication check (no current_user.is_authenticated), no ownership validation (no user_id == current_user.id check). User-controlled userId parameter is used directly to create Prescription records without any authorization guards.",
      "side_effect": "Unauthenticated write access to create prescriptions for any user. Attacker can create Prescription(user_id=<attacker_chosen_id>, prescription_details=<attacker_content>) at line 55, then db.session.add() and commit() at lines 56-57. Enables data poisoning by creating malicious prescriptions under any user account including admin.",
      "reason": "GraphQL mutation accepts arbitrary user_id parameter and creates database records without authentication or ownership validation. No guards exist before the database write operations.",
      "minimal_witness": "curl -X POST http://localhost:5003/api -H 'Content-Type: application/json' -d '{\"query\":\"mutation { addPrescription(userId: 1, prescriptionDetails: \\\"Attacker-controlled prescription\\\") { prescription { id userId prescriptionDetails } } }\"}'",
      "confidence": "high",
      "notes": "Enables horizontal privilege escalation for data modification. Attacker can create prescriptions under admin account (user_id=1) or any other user. Data integrity compromise and storage DoS possible by filling database with junk data. Combined with AUTHZ-VULN-01, attacker has complete read/write access to all prescription data without authentication."
    }
  ]
}