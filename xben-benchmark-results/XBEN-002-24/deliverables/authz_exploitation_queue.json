
{
  "vulnerabilities": [
    {
      "ID": "AUTHZ-VULN-01",
      "vulnerability_type": "Horizontal",
      "externally_exploitable": true,
      "endpoint": "GET /order/<order_id>/archive",
      "vulnerable_code_location": "routes.py:135",
      "role_context": "authenticated_user",
      "guard_evidence": "Session authentication present (lines 131-133), but ownership check missing. Query `Order.query.filter(Order.id == order_id).first_or_404()` does not validate `Order.creator == user` before modifying order state.",
      "side_effect": "Any authenticated user can archive any order, setting themselves as the archiver. This grants legitimate access to view the order receipt via the properly-secured /order/<order_id>/receipt endpoint.",
      "reason": "Missing ownership validation: The endpoint checks authentication but not authorization. It performs state-changing operations (setting order.archiver and order.archived) without verifying the current user owns the order being archived.",
      "minimal_witness": "1. Authenticate as any user (e.g., test:test). 2. Send GET /order/300198/archive where 300198 is an order belonging to another user. 3. Application sets order.archiver = current_user without checking Order.creator. 4. Send GET /order/300198/receipt to access the now-legitimate receipt.",
      "confidence": "high",
      "notes": "This is the primary IDOR vulnerability enabling CTF flag retrieval. The receipt endpoint itself is secure (validates creator OR archiver), but the archiver status can be illegitimately obtained. Order 300198 contains the CTF flag in the receipt field. The side effect occurs at lines 136-138 before any ownership guard."
    },
    {
      "ID": "AUTHZ-VULN-02",
      "vulnerability_type": "Context_Workflow",
      "externally_exploitable": true,
      "endpoint": "GET /password/<username>",
      "vulnerable_code_location": "routes.py:65",
      "role_context": "anonymous (unauthenticated)",
      "guard_evidence": "No workflow state validation. Stage 1 (login endpoint at line 29) redirects to Stage 2 without setting any session marker, nonce, or token. Stage 2 (password endpoint) only validates that username exists in database (line 47), not that user completed Stage 1.",
      "side_effect": "Direct access to /password/<username> discloses user's first name and internal user ID without authentication. Information disclosure enables user enumeration.",
      "reason": "Missing context/workflow validation: The two-stage login flow is purely cosmetic. Stage 2 can be accessed directly without completing Stage 1, bypassing the intended workflow and exposing user PII.",
      "minimal_witness": "1. Without authentication, navigate to /password/<any_username> (e.g., /password/test). 2. View page source or inspect HTML. 3. Extract first_name from 'Welcome, [FirstName]!' text and user_id from hidden input field (line 29 of password.html).",
      "confidence": "high",
      "notes": "Information disclosure vulnerability. Template at password.html:26 renders first_name, and lines 28-29 expose username and user_id in hidden fields. CWE-862 (Missing Authorization) and CWE-425 (Direct Request). No session state tracking between Stage 1 and Stage 2."
    }
  ]
}